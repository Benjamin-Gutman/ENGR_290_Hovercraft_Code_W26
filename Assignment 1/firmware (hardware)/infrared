const int IR_PIN = A0; //Pin at the beginning (0)
const float VREF =4.64; //Reference value for the true voltage (Replace it with the value measured with the multimeter)

int readIR_Average(int n) { //This reads the n values and gives us the average wich makes readings less noisy making the output more stable (But slower response)
  float sum = 0;
  for (int i = 0; i < n; i++) {
    sum += analogRead(IR_PIN);//Measures the analog voltage on the A0 pin then uses Arduino's ADC to convert that voltage in a value 0-1023 (10 bits).
    delay(2);//Waits 2 ms between ADC samples
  }
  return (int)(sum / n);//Average
}

void setup() {
  Serial.begin(115200); //Start the communication link between computer and arduino. Comunication speed (Serial communciation speed between arduino and the computer. Arduino and the Serial Monitur must use the same baud rate or the text won't be readable)
  Serial.println("IR on duty"); //Text to print when the IR starts reading information
}

void loop() {
  int adc = readIR_Average(100); //(Analog-to-Digital converter) We can increase the number N to stabilize it more
  float v = adc * (VREF/ 1023.0);//Arduino represents the voltage with 1024 (2^10) possible codes (0-1023) each corresponds to a small voltage step (ratio*reference voltage)

  Serial.print("ADC=");
  Serial.print(adc);
  Serial.print("  V=");
  Serial.println(v, 3); //Variable voltage is our estimate of the input voltage on the pin, computed from the ADC code.

  delay(100);//Pauses the program for 100 ms
}

//300ms per update for the entire program (100*2ms)+100 ms
//154 adc for 42 cm
//347 adc for 14 cm
